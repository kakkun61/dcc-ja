# S-9.2 デジタルコマンドコントロールの通信標準

[原文](https://www.nmra.org/sites/default/files/s-92-2004-07.pdf)

原文版：July 2004

この標準はデジタルコマンドステーションからデジタルデコーダーに送信される情報の形式について取り扱います。デジタルコマンドステーションは、S-9.1 に記載された NMRA デジタル信号を使って一連のビットを送信することで、この情報をデジタルデコーダーに転送します。この一連のビットをパケットと呼びます。デジタルデコーダーを動作させる命令のうちの1つを符号化するためにパケットは使われます。意図した命令を適切に符号化・複合化するために、パケットは正確に定義されなければいけません。

## A：一般的なパケットの形式

下記の一連のビットによって妥当な NMRA パケットを定義します。この標準の目的において、この一般的なパケットの形式の完全な定義に合致しないビットの並びは「パケット」ではありません。NMRA デジタルモードの動作において妥当なパケットに含まれない命令によってデジタルデコーダーは動作してはいけません<sup>※1</sup>。

※1：It is permissible for *Digital Decoders* to accept formats in addition to the NMRA General Packet Format. See Section C for details.

- **前文**（Preamble）
    - パケットの前文は「1」ビットの並びからなります。デジタルデコーダーは、10個未満の完全な「1」ビットを妥当であると受理してはいけず、12個より多くの完全な「1」ビットの並びをもつパケットの適切な受信を要求します。コマンドステーションは少なくとも14個の完全な前文ビットを送信しないといけません。
- **パケット開始ビット**
    - パケット開始ビットは最初のビットで妥当な前文に続く「0」の値を持ちます。パケット開始ビットは前文を終わらせ、次のビットがアドレスデータバイトであることをしめします。
- **アドレスデータバイト**
    - パケットの最初のバイトは通常、8ビットのアドレス情報をもちます<sup>※2</sup>。転送されるアドレスの最初のビットはアドレスデータバイトの最上位ビットであると定義されます。00000000 と 11111110 そして 11111111 の値をもつアドレスデータバイトは特別な操作のために予約されており、この標準もしくは関連する推奨慣例において提供される場合をのぞき転送してはいけません。
- 1回以上の繰り返し
    - **データバイト開始ビット**
        - このビットはデータバイトに先行し「0」の値をもちます。
    - **データバイト**
        - それぞれのデータバイトは8ビットを含み、アドレス・命令・データ・エラー検出目的に使用される情報をもちます。転送されるデータのそれぞれのデータバイトの最初のビットはデータバイトの最上位ビットであると定義されます。
- **パケット終了ビット**
    - このビットはパケットの終了をしめし、「1」の値をもちます<sup>※3</sup>。

※2：The first byte can also be used in special cases to indicate instructions. See the Service Mode Recommended Practice (RP-9.2.3) for an example of this dual use.

※3：The Packet End Bit may count as one of the preamble bits of the subsequent packet if there are no inter-packet bits from an alternative command control protocol. The DCC bitstream must continue for an additional 26 µS (minimum) after the packet end bit.

Figure 1 provides an example of an acceptable command control packet that uses three data bytes: one address data byte, one instruction data byte and one error detection data byte.

## B：基準パケット

基準パケットは異なるシステム間の最低限の相互運用性を提供するために含まれます。異なった種類のデコーダーや追加の機能・アドレス・速度のためのより複雑なパケットの形式は「拡張パケット形式の推奨慣例」（RP-9.2.1）で提供されます。この標準の意図するところは、コマンドステーションは基準パケット意味論にしたがって操縦者の制御の入力を符号化しなければいけないこと・デジタルデコーダーは基準パケット意味論にしたがって適切に機関車を制御識する電気的な出力を識別し提供しなければいけないことの確認です。デジタルデコーダーアイドルパケットとデジタルデコーダーブロードキャスト停止パケット<sup>※4</sup>はコマンドステーションには任意でデコーダーには必須です。

※4：Broadcast Stop Packet requirement for decoders, effective 1-Aug-2002.

### 機関車デコーダーのための速度・方向パケット

```
111111111111 0 0AAAAAAA 0 01DCSSSS 0 EEEEEEEE 1
前文           バイト1    バイト2    バイト3（エラー検出データバイト）
```

- バイト1：アドレスデータバイト 0AAAAAAA
    - アドレスデータバイトは意図したパケットの受信者のアドレスをもちます。全てのデジタルデコーダーは、基準パケット返答するために自身のアドレスを保持し識別できなければいけません。機関車デジタルデコーダーは使用者がこのアドレスを簡単に設定できる方法で基準アドレスの全範囲を処理できなければいけません<sup>※5</sup>。デジタルコマンドステーションが妥当なアドレスの個数を制限することは、包装や説明書にはっきりと明確に記載されている限り許容されます。
- バイト2：命令データバイト 01DCSSSS
    - 命令データバイトは速度と方向の情報を機関車デジタルデコーダーに転送するために使われるデータバイトです。ビット0～3<sup>※6</sup>は速度のための4ビットを提供します。ビット0は最下位ビットです。バイト2のビット4（C）はデフォルトで追加の速度ビットで、速度ビットの最下位ビットです。後方互換性のためにこのビットは代わりにヘッドライトを制御するために使われることがあります。この任意の使用は RP-9.2.1 に定義されています。ビット5（D）は方向のための1ビットです。方向ビット（D）が「1」の値のとき、機関車は前方に進まないとけません<sup>※7</sup>。「0」の値をもつ方向ビットは機関車を後方に動かさないといけません。ビット6と7はこの命令データバイトが速度と方向であることをあらわす「01」のビットの並びをもちます。
- バイト3：エラー検出データバイト EEEEEEEE
    - エラー検出データバイトは転送エラーの存在を検出するために使用されるデータバイトです。

※5：The Service Mode Recommended Practice (RP-9.2.3) contains one example of an acceptable method for user address configuration.

※6：Bits within a byte are numbered right to left with bit 0 (the right most bit) being the least significant bit and bit 7 (the left most bit) being the most significant bit.

※7：Forward in this case is in the direction of the front of the locomotive, as observed from the engineer's position within the locomotive.

※8：Other bit patterns in bits 7 and 6 are reserved for other types of instruction data, and are defined in the Extended Packet Format Recommended Practice (RP-9.2.1).
